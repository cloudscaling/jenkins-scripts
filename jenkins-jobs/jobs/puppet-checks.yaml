- builder:
    name: puppet-syntax-check
    builders:
      - shell: |
          #!/bin/bash -e

          export GEM_HOME=$WORKSPACE/.gem
          gem install puppet-lint
          gem install puppet-lint-absolute_template_path
          gem install puppet-lint-unquoted_string-check
          gem install puppet-lint-resource_reference_syntax
          gem install puppet-lint-trailing_newline-check

          cd {repo}
          echo "INFO: run puppet-lint"
          $GEM_HOME/bin/puppet-lint --fail-on-warnings --no-autoloader_layout-check --no-documentation-check .

          echo "INFO: run puppet module build"
          puppet module build


- job:
    name: puppet-scaleio-check
    description: "Runs syntax and unit tests for the puppet from github.com/emccode"
    defaults: global
    scm:
      - emc-puppet-scaleio
    triggers:
      - pollscm:
          cron: "H/5 * * * *"
    builders:
      - puppet-syntax-check:
          repo: "puppet-scaleio"


- job:
    name: puppet-scaleio-openstack-check
    description: "Runs just syntax tests for the puppet from github.com/emccode"
    defaults: global
    scm:
      - emc-puppet-scaleio-openstack
    triggers:
      - pollscm:
          cron: "H/5 * * * *"
    builders:
      - puppet-syntax-check:
          repo: "puppet-scaleio-openstack"
